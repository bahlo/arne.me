<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title><![CDATA[Arne Bahlo]]></title>
        <description><![CDATA[Arne Bahlo]]></description>
        <link>https://arne.me</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Sat, 19 Nov 2022 13:16:03 GMT</lastBuildDate>
        <atom:link href="https://arne.me/feed.xml" rel="self" type="application/rss+xml"/>
        <item>
            <title><![CDATA[You're using email wrong]]></title>
            <description><![CDATA[<p>You probably don't like email, not a lot of people do.
That's because you're using it wrong.</p>
<p>Chances are that if you look at your inbox, it's full of unsolicited marketing
emails, log-in notifications or spam.
Or you're doing inbox zero and all that trash lives in your archive.</p>
<p>As everything else, email is subject (hah) to entropy.
If you're not careful, chaos will take over and your email inbox will look like
the screenshot above.</p>
<h2>A different concept</h2>
<p>As controversial as the company behind <a href="https://www.hey.com">HEY</a> is, the
concept that they introduced with their mail app has fundamentally changed how I
think about email.
I adapted the part that resonated with me to my <a href="https://fastmail.com">Fastmail</a>
account like this:</p>
<h3>Inbox</h3>
<p>This is where all emails sent by humans end up.
That's it.</p>
<h3>Papertrail</h3>
<p>Notifications, invoices, everything that you don't want to delete but are not
really interested in.
This folder has about 1.6k unread emails right now.
They're not meant to be read, but if I need to look something up, I know where
to look.</p>
<h3>Newsfeed</h3>
<p>I'm subscribed to over 20 newsletters and all of them end up in here.
If I have time, I'll read the newsletters and add the articles I want to read to
<a href="https://instapaper.com">Instapaper</a>.</p>
<p>By the way, if you're looking for something to add to your newsfeed, check out
<a href="/weekly">Arne's Weekly</a>.</p>
<h2>The Setup</h2>
<p>I'm using Fastmail with a custom domain and have aliases with rules for the
different destinations, for example <code>papertrail@example.org</code> or
<code>newsfeed@example.org</code>.</p>
<p>This way, if I sign up for a new service or subscribe to a newsletter, instead
of having to adapt existing rules, I can use the proper email address and
everything will go where it should.</p>
<p>This is not Fastmail specific, you can do the same with most providers.
For example, if you have <code>hikingfan@gmail.com</code>, you could set a rule for
<code>hikingfan+papertrail@gmail.com</code> and one for <code>hikingfan+newsfeed@gmail.com</code> and
use those email addresses when signing up.</p>
<h2>The human factor</h2>
<p>If I look at my inbox, it's a joy.
Feedback to blog posts, articles and personal messages from people I care about.
Sticking with this strategy made email about humans, not about machines.</p>
<p>I encourage you to try it!</p>
<p>If you have a different concept, feedback or ideas, please
<a href="mailto:hey@arne.me">let me know</a>.</p>
<p><strong>Update (Mar 08, 2022):</strong> Multiple people have responded with their systems and
questions (which I love, please keep doing that), some missed a way to track if
a service "lost" their email address.
If you use an alias, e.g. <code>papertrail@example.org</code>, you can use the <code>+</code> operator
like this: <code>papertrail+twitter@example.org</code>.
The sorting rule will be a bit more complicated, but you won't have to adapt
it every time you sign up for something.</p>
]]></description>
            <link>https://arne.me/blog/youre-using-email-wrong</link>
            <guid isPermaLink="false">youre-using-email-wrong</guid>
            <dc:creator><![CDATA[Arne Bahlo]]></dc:creator>
            <pubDate>Sat, 05 Mar 2022 23:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Plex on NixOS]]></title>
            <description><![CDATA[<p>A few weeks ago, the hard drive (yes, I know) in my home lab died.
It was a sad moment, especially because I ran Plex on it and rely on that for my
music and audiobook needs.</p>
<p>The upside is that it gave me the opportunity to rethink my Plex setup.
Hosting it at home is great for storage costs and control, but it's hard to
share with friends or access on the go, especially with a NATed IPv4, so I
decided to move to the cloud.</p>
<h2>Prerequisites</h2>
<p>I chose <a href="https://cloud.hetzner.com">Hetzner Cloud</a> because I like their service,
and they use green energy.</p>
<p>The biggest challenge was storage. Hetzner charges around €50/month for a 1 TB
volume (others have comparable pricing).</p>
<p>But then my friend Eric told me about <a href="https://rclone.org">rclone</a> and its
ability to mount blob storage (which is cheap) as a virtual disk.
That means Plex sees all files as if they were actually there and if it tries
to read a file, it's downloaded on demand if it's not cached already.</p>
<p>Armed with this knowledge, I started setting up the server.</p>
<h2>NixOS</h2>
<p>NixOS is a declarative and reproducible operating system.
You have a configuration file in <code>/etc/nixos/configuration.nix</code> that defines
your installed applications, configuration and system setup.
And if you mess up, you can always roll back.</p>
<p>The first I did was creating a server on Hetzner with any distribution (I went
width a <a href="https://www.hetzner.com/cloud#pricing">CPX11</a> and Ubuntu) and then following the instructions on the
<a href="https://github.com/nix-community/nixos-install-scripts/tree/master/hosters/hetzner-cloud">install scripts for Hetzner Cloud</a>.</p>
<p>If you follow along, make sure to choose a server with at least 40 GB of disk
space.</p>
<p>After booting into NixOS, I changed the root password by running <code>passwd</code> and
upgraded NixOS (see <a href="https://nixos.org/manual/nixos/stable/index.html#sec-upgrading">Upgrading NixOS</a>).
If you want to further secure your NixOS installation, Christine Dodrill has a
great guide called <a href="https://christine.website/blog/paranoid-nixos-2021-07-18">Paranoid NixOS Setup</a>.</p>
<h2>Storage</h2>
<p>I decided to go with <a href="https://www.backblaze.com/b2/cloud-storage.html">Backblaze B2</a>
as I have used it before, it's cheaper than S3, and I don't support Amazon.
If you want to use something else, rclone supports
<a href="https://rclone.org/#providers">a lot of providers</a>.</p>
<p>After creating a bucket for the media, I created an Application Key and made
note of the <code>keyID</code> and <code>applicationKey</code>.</p>
<p>Then I added the following lines to my Nix configuration at
<code>/etc/nixos/configuration.nix</code> to install rclone and create a
<code>/etc/rclone/rclone.conf</code> for the bucket:</p>
<pre><code>environment.systemPackages = [ pkgs.rclone ];

environment.etc = {
  "rclone/rclone.conf" = {
    text = ''
      [b2]
      type = b2
      account = &#x3C;keyID>
      key = &#x3C;applicationKey>
      hard_delete = true
      versions = false
    '';
    mode = "0644";
  };
};
</code></pre>
<p>If you follow along, make sure to replace <code>&#x3C;keyID></code> and <code>&#x3C;applicationKey></code>.</p>
<p>By the way, NixOS comes with nano preinstalled, so if you want a real editor,
you can get it with the following command:</p>
<pre><code>$ nix-shell -p vim
</code></pre>
<p>For the disk mount, I created a Systemd service that mounts the bucket on start
and automatically starts on boot.</p>
<pre><code>systemd.services.plex_media = {
  enable = true;
  description = "Mount media dir";
  wantedBy = ["multi-user.target"];
  serviceConfig = {
    ExecStartPre = "/run/current-system/sw/bin/mkdir -p /mnt/media";
    ExecStart = ''
      ${pkgs.rclone}/bin/rclone mount 'b2:&#x3C;bucket name>/' /mnt/media \
        --config=/etc/rclone/rclone.conf \
        --allow-other \
        --allow-non-empty \
        --log-level=INFO \
        --buffer-size=50M \
        --drive-acknowledge-abuse=true \
        --no-modtime \
        --vfs-cache-mode full \
        --vfs-cache-max-size 20G \
        --vfs-read-chunk-size=32M \
        --vfs-read-chunk-size-limit=256M
    '';
    ExecStop = "/run/wrappers/bin/fusermount -u /mnt/media";
    Type = "notify";
    Restart = "always";
    RestartSec = "10s";
    Environment = ["PATH=${pkgs.fuse}/bin:$PATH"];
  };
};
</code></pre>
<p>If you follow along, make sure to replace <code>&#x3C;bucket name></code>.</p>
<p>The <code>--vfs-*</code> arguments configure the virtual file system.
I only have 40 GB local disk space, so I set the cache size to 20 GB (using
<code>--vfs-cache-max-size</code>).</p>
<p>I then ran <code>nixos-rebuild switch</code> to apply the configuration, uploaded some
data to the bucket and listed <code>/mnt/media</code> to make sure everything works.</p>
<h2>Plex</h2>
<p>NixOS has a predefined service for Plex, which I used like this:</p>
<pre><code>nixpkgs.config.allowUnfree = true; # Plex is unfree

services.plex = {
  enable = true;
  dataDir = "/var/lib/plex";
  openFirewall = true;
  user = "plex";
  group = "plex";
};
</code></pre>
<p>With this configuration, Nix will open the correct ports in the firewall,
create a user called <code>plex</code> with a group also called <code>plex</code> and install the Plex
Media Server with the configuration in <code>/var/lib/plex</code>.</p>
<h3>Audiobooks Plugin</h3>
<p>I wanted to use the <a href="https://github.com/macr0dev/Audiobooks.bundle">Audiobooks.bundle</a>
metadata agent for better matching, so I added this to the <code>let</code>-section at the
top of <code>plex.nix</code>:</p>
<pre><code>let
  audiobooksPlugin = pkgs.stdenv.mkDerivation {
    name = "Audiobooks.bundle";
    src = pkgs.fetchurl {
      url = https://github.com/macr0dev/Audiobooks.bundle/archive/9b1de6b66cd8fe11c7d27623d8579f43df9f8b86.zip;
      sha256 = "539492e3b06fca2ceb5f0cb6c5e47462d38019317b242f6f74d55c3b2d5f6e1d";
    };
    buildInputs = [ pkgs.unzip ];
    installPhase = "mkdir -p $out; cp -R * $out/";
  };
in
  # ...
</code></pre>
<p>That fetches the commit <code>9b1de6b</code> of the audiobooks plugin and makes sure that
the SHA256 is correct.</p>
<p>Then I told Plex to use this plugin like this:</p>
<pre><code>services.plex.managePlugins = true;
services.plex.extraPlugins = [audiobooksPlugin];
</code></pre>
<p>If you're following along and get an error which says
<code>services.plex.managePlugins</code> no longer has an effect, remove that line.</p>
<p>At this point, after running <code>nixos-rebuild switch</code> again, I was able to access
the Plex interface at <code>https://&#x3C;domain or ip>:32400</code>.</p>
<p>Plex needs an initial configuration, but only allows it if it's coming from a
local connection.
One way to do this is an SSH tunnel, which I opened like this:</p>
<pre><code>$ ssh -L 32400:localhost:32400 user@domain-or-ip
</code></pre>
<p>Then I opened <a href="http://localhost:32400/web">http://localhost:32400/web</a> in my local browser and set up Plex.</p>
<h2>Nginx</h2>
<p>I wanted a nice domain with HTTPS on 443 (instead of HTTP on port 32400), so I
set up <a href="https://nginx.com">Nginx</a> with <a href="https://letsencrypt.org">Let's Encrypt</a>
next.</p>
<p>The first thing I did was setting <code>openFirewall</code> to false in the Plex
configuration.
Then I allowed port 80 and 443 for HTTP and HTTPS and all the
<a href="https://github.com/NixOS/nixpkgs/blob/nixos-21.11/nixos/modules/services/misc/plex.nix#L157-L160">Plex ports</a>
except for 32400 as we want to proxy the web interface through Nginx.</p>
<pre><code>services.plex = {
  openFirewall = false;
  # ...
};

networking.firewall = {
  allowedTCPPorts = [ 3005 8324 32469 80 443 ];
  allowedUDPPorts = [ 1900 5353 32410 32412 32413 32414 ];
};
</code></pre>
<p>Then I configured ACME:</p>
<pre><code>security.acme.acceptTerms = true;
security.acme.defaults.email = "&#x3C;your email>";
</code></pre>
<p>The default provider is Let's Encrypt, you can find their terms of service here:
<a href="https://letsencrypt.org/repository/">Policy and Legal Repository</a>.</p>
<p>Now it was time to add the Nginx service.
I used recommended settings and only PFS-enabled ciphers with AES256.
As this proxies Plex requests, I forwarded some headers as well.
Here's the code:</p>
<pre><code>services.nginx = {
  enable = true;

  # Recommended settings
  recommendedGzipSettings = true;
  recommendedOptimisation = true;
  recommendedProxySettings = true;
  recommendedTlsSettings = true;

  # Only allow PFS-enabled ciphers with AES256
  sslCiphers = "AES256+EECDH:AES256+EDH:!aNULL";

  virtualHosts = {
    "&#x3C;your domain>" = {
      forceSSL = true;
      enableACME = true;
      extraConfig = ''
        # Some players don't reopen a socket and playback stops totally instead of resuming after an extended pause
        send_timeout 100m;
        # Plex headers
        proxy_set_header X-Plex-Client-Identifier $http_x_plex_client_identifier;
        proxy_set_header X-Plex-Device $http_x_plex_device;
        proxy_set_header X-Plex-Device-Name $http_x_plex_device_name;
        proxy_set_header X-Plex-Platform $http_x_plex_platform;
        proxy_set_header X-Plex-Platform-Version $http_x_plex_platform_version;
        proxy_set_header X-Plex-Product $http_x_plex_product;
        proxy_set_header X-Plex-Token $http_x_plex_token;
        proxy_set_header X-Plex-Version $http_x_plex_version;
        proxy_set_header X-Plex-Nocache $http_x_plex_nocache;
        proxy_set_header X-Plex-Provides $http_x_plex_provides;
        proxy_set_header X-Plex-Device-Vendor $http_x_plex_device_vendor;
        proxy_set_header X-Plex-Model $http_x_plex_model;
        # Buffering off send to the client as soon as the data is received from Plex.
        proxy_redirect off;
        proxy_buffering off;
      '';
      locations."/" = {
        proxyPass = "http://localhost:32400";
        proxyWebsockets = true;
      };
    };
  };
};
</code></pre>
<p>If you're following along, make sure to replace <code>&#x3C;your domain></code>.</p>
<p>To secure things even further, I set some headers for every request:</p>
<pre><code>services.nginx.commonHttpConfig = ''
  # Add HSTS header with preloading to HTTPS requests.
  # Adding this header to HTTP requests is discouraged
  map $scheme $hsts_header {
      https   "max-age=31536000; includeSubdomains; preload";
  }
  add_header Strict-Transport-Security $hsts_header;
  # Enable CSP for your services.
  #add_header Content-Security-Policy "script-src 'self'; object-src 'none'; base-uri 'none';" always;
  # Minimize information leaked to other domains
  add_header 'Referrer-Policy' 'origin-when-cross-origin';
  # Disable embedding as a frame
  add_header X-Frame-Options DENY;
  # Prevent injection of code in other mime types (XSS Attacks)
  add_header X-Content-Type-Options nosniff;
  # Enable XSS protection of the browser.
  # May be unnecessary when CSP is configured properly (see above)
  add_header X-XSS-Protection "1; mode=block";
'';
</code></pre>
<p>Finally, I ran <code>nixos-rebuild switch</code> one last time to apply the configuration.
Then I opened <code>https://my-domain</code> in a browser and started creating Plex
libraries.</p>
<h2>Pricing</h2>
<p>The CPX11 costs €4,75/month with backups enabled, B2 costs $0.005/GB/month
storage + $0.01/GB downloaded.
Storage pricing depends heavily on the amount of media stored and the amount
of media downloaded.
I pay around €10/month for my setup.</p>
<h2>Wrapping up</h2>
<p>All that's left to do now is further configure NixOS to set a hostname,
timezone, installed packages like <code>htop</code> and enabling
<a href="https://nixos.org/manual/nixos/stable/index.html#sec-upgrading-automatic">Automatic Upgrades</a>.</p>
<p>In case that's useful for you, here is the
<a href="https://github.com/bahlo/arne.me/blob/main/content/blog/plex-on-nixos/configuration.nix">configuration.nix</a>
from when I tested this blog post.</p>
<p>If you discover an issue or have a question, please don't hesitate to
<a href="mailto:hey@arne.me">let me know</a>, I'm more than happy to help!</p>
]]></description>
            <link>https://arne.me/blog/plex-on-nixos</link>
            <guid isPermaLink="false">plex-on-nixos</guid>
            <dc:creator><![CDATA[Arne Bahlo]]></dc:creator>
            <pubDate>Mon, 21 Feb 2022 23:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Hello world]]></title>
            <description><![CDATA[<p>I've had many blogs, but this is the first post on this site, so stay tuned. ❤️</p>
]]></description>
            <link>https://arne.me/blog/hello-world</link>
            <guid isPermaLink="false">hello-world</guid>
            <dc:creator><![CDATA[Arne Bahlo]]></dc:creator>
            <pubDate>Sat, 12 Feb 2022 23:00:00 GMT</pubDate>
        </item>
    </channel>
</rss>